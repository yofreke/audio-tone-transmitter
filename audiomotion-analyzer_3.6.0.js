/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/audiomotion-analyzer@3.6.0/src/audioMotion-analyzer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 3.6.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */
const VERSION="3.6.0",TAU=2*Math.PI,HALF_PI=Math.PI/2,RPM=TAU/3600,ROOT24=2**(1/24),C0=440*ROOT24**-114;export default class AudioMotionAnalyzer{constructor(t,e={}){let i;if(this._ready=!1,this._gradients={classic:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )",{pos:.6,color:"hsl( 60, 100%, 50% )"},"hsl( 120, 100%, 50% )"]},prism:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"]},rainbow:{bgColor:"#111",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 47% )","hsl( 240, 100%, 58% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"]}},this._container=t||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270,e.source&&(i=e.source.context));else if(i=e.audioCtx);else try{i=new(window.AudioContext||window.webkitAudioContext)}catch(t){throw new AudioMotionError("ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?")}if(!i.createGain)throw new AudioMotionError("ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid");const s=this._analyzer=[i.createAnalyser(),i.createAnalyser()],a=this._splitter=i.createChannelSplitter(2),h=this._merger=i.createChannelMerger(2);this._input=i.createGain(),this._output=i.createGain(),this._sources=[],e.source&&this.connectInput(e.source);for(const t of[0,1])a.connect(s[t],t);h.connect(this._output),this._outNodes=[],!1!==e.connectSpeakers&&this.connectOutput(),this._energy={val:0,peak:0,hold:0};const r=document.createElement("canvas");r.style="max-width: 100%;",this._canvasCtx=r.getContext("2d");for(const t of["_scaleX","_scaleR"])this[t]=document.createElement("canvas").getContext("2d");this._fsEl=e.fsElement||r;const n=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout((()=>{this._fsChanging||(this._setCanvas("resize"),this._fsTimeout=0)}),60))};if(window.ResizeObserver){new ResizeObserver(n).observe(this._container)}window.addEventListener("resize",n),r.addEventListener("fullscreenchange",(()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas("fschange"),this._fsTimeout=window.setTimeout((()=>{this._fsChanging=!1,this._fsTimeout=0}),60)}));const o=()=>{"suspended"==i.state&&i.resume(),window.removeEventListener("click",o)};window.addEventListener("click",o),this._calcAux(),this._setProps(e,!0),this.useCanvas&&this._container.appendChild(r),this._ready=!0,this._setCanvas("create")}get alphaBars(){return this._alphaBars}set alphaBars(t){this._alphaBars=!!t,this._calcAux()}get barSpace(){return this._barSpace}set barSpace(t){this._barSpace=+t||0,this._calcAux()}get fftSize(){return this._analyzer[0].fftSize}set fftSize(t){for(const e of[0,1])this._analyzer[e].fftSize=t;const e=this._analyzer[0].frequencyBinCount;this._fftData=[new Uint8Array(e),new Uint8Array(e)],this._calcBars()}get gradient(){return this._gradient}set gradient(t){if(!this._gradients.hasOwnProperty(t))throw new AudioMotionError("ERR_UNKNOWN_GRADIENT",`Unknown gradient: '${t}'`);this._gradient=t,this._makeGrad()}get height(){return this._height}set height(t){this._height=t,this._setCanvas("user")}get ledBars(){return this._showLeds}set ledBars(t){this._showLeds=!!t,this._calcAux()}get loRes(){return this._loRes}set loRes(t){this._loRes=!!t,this._setCanvas("lores")}get lumiBars(){return this._lumiBars}set lumiBars(t){this._lumiBars=!!t,this._calcAux(),this._calcLeds(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(t){for(const e of[0,1])this._analyzer[e].maxDecibels=t}get maxFreq(){return this._maxFreq}set maxFreq(t){if(t<1)throw new AudioMotionError("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._maxFreq=t,this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(t){for(const e of[0,1])this._analyzer[e].minDecibels=t}get minFreq(){return this._minFreq}set minFreq(t){if(t<1)throw new AudioMotionError("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._minFreq=t,this._calcBars()}get mirror(){return this._mirror}set mirror(t){this._mirror=0|Math.sign(t),this._calcAux(),this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(t){const e=0|t;if(!(e>=0&&e<=10&&9!=e))throw new AudioMotionError("ERR_INVALID_MODE",`Invalid mode: ${t}`);this._mode=e,this._calcAux(),this._calcBars(),this._makeGrad()}get outlineBars(){return this._outlineBars}set outlineBars(t){this._outlineBars=!!t,this._calcAux()}get radial(){return this._radial}set radial(t){this._radial=!!t,this._calcAux(),this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(t){if((t=+t||0)<0||t>=1)throw new AudioMotionError("ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1");this._reflexRatio=t,this._calcAux(),this._makeGrad(),this._calcLeds()}get showLeds(){return this.ledBars}set showLeds(t){this.ledBars=t}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(t){for(const e of[0,1])this._analyzer[e].smoothingTimeConstant=t}get spinSpeed(){return this._spinSpeed}set spinSpeed(t){t=+t||0,void 0!==this._spinSpeed&&0!=t||(this._spinAngle=-HALF_PI),this._spinSpeed=t}get splitGradient(){return this._splitGradient}set splitGradient(t){this._splitGradient=!!t,this._makeGrad()}get stereo(){return this._stereo}set stereo(t){this._stereo=!!t,this._input.disconnect(),this._input.connect(this._stereo?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._stereo?this._merger:this._output),this._calcAux(),this._createScales(),this._calcLeds(),this._makeGrad()}get volume(){return this._output.gain.value}set volume(t){this._output.gain.value=t}get width(){return this._width}set width(t){this._width=t,this._setCanvas("user")}get audioCtx(){return this._input.context}get canvas(){return this._canvasCtx.canvas}get canvasCtx(){return this._canvasCtx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get energy(){return this.getEnergy()}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._isAlphaBars}get isFullscreen(){return(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._isLedDisplay}get isLedDisplay(){return this.isLedBars}get isLumiBars(){return this._isLumiBars}get isOctaveBands(){return this._isOctaveBands}get isOn(){return void 0!==this._runId}get isOutlineBars(){return this._isOutline}get peakEnergy(){return this.getEnergy("peak")}get pixelRatio(){return this._pixelRatio}static get version(){return"3.6.0"}connectInput(t){const e=t instanceof HTMLMediaElement;if(!e&&!t.connect)throw new AudioMotionError("ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode");const i=e?this.audioCtx.createMediaElementSource(t):t;return this._sources.includes(i)||(i.connect(this._input),this._sources.push(i)),i}connectOutput(t=this.audioCtx.destination){if(!this._outNodes.includes(t)&&(this._output.connect(t),this._outNodes.push(t),1==this._outNodes.length))for(const t of[0,1])this._analyzer[t].connect(this._stereo||t?this._merger:this._output,0,t)}disconnectInput(t){t?Array.isArray(t)||(t=[t]):t=Array.from(this._sources);for(const e of t){const t=this._sources.indexOf(e);t>=0&&(e.disconnect(this._input),this._sources.splice(t,1))}}disconnectOutput(t){if((!t||this._outNodes.includes(t))&&(this._output.disconnect(t),this._outNodes=t?this._outNodes.filter((e=>e!==t)):[],0==this._outNodes.length))for(const t of[0,1])this._analyzer[t].disconnect()}getBars(){return Array.from(this._bars,(({posX:t,freqLo:e,freqHi:i,hold:s,peak:a,value:h})=>({posX:t,freqLo:e,freqHi:i,hold:s,peak:a,value:h})))}getEnergy(t,e){if(void 0===t)return this._energy.val;if(t!=+t){if("peak"==t)return this._energy.peak;const i={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!i[t])return null;[t,e]=i[t]}const i=this._freqToBin(t),s=e?this._freqToBin(e):i,a=this._stereo+1;let h=0;for(let t=0;t<a;t++)for(let e=i;e<=s;e++)h+=this._fftData[t][e];return h/(s-i+1)/a/255}registerGradient(t,e){if("string"!=typeof t||0==t.trim().length)throw new AudioMotionError("ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string");if("object"!=typeof e)throw new AudioMotionError("ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object");if(void 0===e.colorStops||e.colorStops.length<2)throw new AudioMotionError("ERR_GRADIENT_MISSING_COLOR","Gradient must define at least two colors");this._gradients[t]={bgColor:e.bgColor||"#111",dir:e.dir,colorStops:e.colorStops},t==this._gradient&&this._makeGrad()}setCanvasSize(t,e){this._width=t,this._height=e,this._setCanvas("user")}setFreqRange(t,e){if(t<1||e<1)throw new AudioMotionError("ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1");this._minFreq=Math.min(t,e),this._maxFreq=Math.max(t,e),this._calcBars()}setLedParams(t){let e,i,s;t&&(e=0|t.maxLeds,i=+t.spaceV,s=+t.spaceH),this._ledParams=e>0&&i>0&&s>=0?[e,i,s]:void 0,this._calcLeds()}setOptions(t){this._setProps(t)}setSensitivity(t,e){for(const i of[0,1])this._analyzer[i].minDecibels=Math.min(t,e),this._analyzer[i].maxDecibels=Math.max(t,e)}toggleAnalyzer(t){const e=this.isOn;return void 0===t&&(t=!e),e&&!t?(cancelAnimationFrame(this._runId),this._runId=void 0):!e&&t&&(this._frame=this._fps=0,this._time=performance.now(),this._runId=requestAnimationFrame((t=>this._draw(t)))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const t=this._fsEl;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}}_calcAux(){const t=this.canvas,e=this._radial,i=this._stereo&&!e,s=t.width>>1;this._radius=Math.min(t.width,t.height)*(this._stereo?.375:.125)|0,this._barSpacePx=Math.min(this._barWidth-1,this._barSpace>0&&this._barSpace<1?this._barWidth*this._barSpace:this._barSpace),this._isOctaveBands=this._mode%10!=0,this._isLedDisplay=this._showLeds&&this._isOctaveBands&&!e,this._isLumiBars=this._lumiBars&&this._isOctaveBands&&!e,this._isAlphaBars=this._alphaBars&&!this._isLumiBars&&10!=this._mode,this._isOutline=this._outlineBars&&this._isOctaveBands&&!this._isLumiBars&&!this._isLedDisplay,this._maximizeLeds=!this._stereo||this._reflexRatio>0&&!this._isLumiBars,this._channelHeight=t.height-(i&&!this._isLedDisplay?.5:0)>>i,this._analyzerHeight=this._channelHeight*(this._isLumiBars||e?1:1-this._reflexRatio)|0,this._channelGap=i?t.height-2*this._channelHeight:0,this._analyzerWidth=t.width-s*(0!=this._mirror),this._initialX=s*(-1==this._mirror&&!e)}_calcBars(){const t=this._bars=[];if(!this._ready)return;const e=t=>t*this.audioCtx.sampleRate/this.fftSize||1,i=(e,i,s,a,h,r,n)=>t.push({posX:e,binLo:i,binHi:s,freqLo:a,freqHi:h,ratioLo:r,ratioHi:n,peak:[0,0],hold:[0],value:[0]}),s=this._analyzerWidth,a=this._initialX,h=this._maxFreq,r=this._minFreq;let n,o;if(this._isOctaveBands){let l=[];for(let t=0;t<11;t++)for(let i=0;i<24;i++){const s=C0*ROOT24**(24*t+i),a=this._freqToBin(s,"floor"),h=e(a),r=(s-h)/(e(a+1)-h);l.push({freq:s,bin:a,ratio:r})}const _=[0,1,2,3,4,6,8,12,24][this._mode];for(let s=0;s<l.length;s+=_){let{freq:a,bin:n,ratio:o}=l[s],{freq:c,bin:d,ratio:u}=l[s+_-1];const f=t.length,g=t[f-1];if(c>h||d>=this.fftSize/2){g.binHi++,g.ratioHi=0,g.freqHi=e(g.binHi);break}if(a>=r){if(f>0){const i=n-g.binHi;i>1&&(g.binHi=n-(i>>1),g.ratioHi=0,g.freqHi=e(g.binHi),f>1&&g.binHi>g.binLo&&g.binLo>t[f-2].binHi&&(g.ratioLo=0,g.freqLo=e(g.binLo)),n=g.binHi+1),d>n&&n>g.binHi&&(o=0,a=e(n))}i(0,n,d,a,c,o,u)}}this._barWidth=s/t.length,t.forEach(((t,e)=>t.posX=a+e*this._barWidth)),n=Math.log10(t[0].freqLo),o=s/(Math.log10(t[t.length-1].freqHi)-n)}else{this._barWidth=1,n=Math.log10(r),o=s/(Math.log10(h)-n);const l=this._freqToBin(r,"floor"),_=this._freqToBin(h);let c=-999;for(let s=l;s<=_;s++){const h=e(s),r=a+Math.round(o*(Math.log10(h)-n));r>c?(i(r,s,s,h,h,0,0),c=r):t.length&&(t[t.length-1].binHi=s,t[t.length-1].freqHi=h)}}this._minLog=n,this._logWidth=o,this._calcAux(),this._createScales(),this._calcLeds()}_calcLeds(){if(!this._isOctaveBands||!this._ready)return;const t=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),e=this._ledParams,[i,s,a]=e||[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]][this._mode];let h,r,n=this._analyzerHeight;if(e){const e=2*t;let a;h=i+1;do{h--,a=n/h/(1+s),r=a*s}while((a<e||r<e)&&h>1)}else{const e=540/s;r=Math.min(s*t,Math.max(2,n/e+.1|0))}this._maximizeLeds&&(n+=r),e||(h=Math.min(i,n/(2*r)|0)),this._leds=[h,a>=1?a:this._barWidth*a,r,n/h-r]}_createScales(){const t=[16,31,63,125,250,500,1e3,2e3,4e3,8e3,16e3],e=this._canvasCtx.canvas,i=this._scaleX,s=this._scaleR,a=i.canvas,h=s.canvas,r=.03*Math.min(e.width,e.height)|0;h.width=h.height=(this._radius<<1)+this._stereo*r;const n=h.width>>1,o=n-.7*r,l=(t,i)=>{const a=TAU*(t/e.width),h=a-HALF_PI,r=o*Math.cos(h),l=o*Math.sin(h);s.save(),s.translate(n+r,n+l),s.rotate(a),s.fillText(i,0,0),s.restore()};a.width|=0,i.fillStyle=s.strokeStyle="#000c",i.fillRect(0,0,a.width,a.height),s.arc(n,n,n-r/2,0,TAU),s.lineWidth=r,s.stroke(),i.fillStyle=s.fillStyle="#fff",i.font=(a.height>>1)+"px sans-serif",s.font=(r>>1)+"px sans-serif",i.textAlign=s.textAlign="center";for(const s of t){const t=s>=1e3?s/1e3+"k":s,h=this._logWidth*(Math.log10(s)-this._minLog);h>=0&&h<=this._analyzerWidth&&(i.fillText(t,this._initialX+h,.75*a.height),h<this._analyzerWidth&&l(h,t),this._mirror&&(i.fillText(t,(this._initialX||e.width)-h,.75*a.height),h>10&&l(-h,t)))}}_draw(t){const e=this._canvasCtx,i=e.canvas,s=this._scaleX.canvas,a=this._scaleR.canvas,h=this._energy,r=this._mode,n=this._isAlphaBars,o=this._isLedDisplay,l=this._isLumiBars,_=this._isOctaveBands,c=this._isOutline,d=this._radial,u=this._stereo,f=+this.lineWidth,g=this._mirror,m=this._channelHeight,p=this._channelGap,w=this._analyzerHeight,b=d?i.width:this._analyzerWidth,v=this._initialX,x=v+b,A=i.width>>1,y=i.height>>1,R=this._radius,S=d?Math.min(A,y)-R:w,B=this.useCanvas;h.val>0&&(this._spinAngle+=this._spinSpeed*RPM);const L=t=>{if(t&&f){const t=e.globalAlpha;e.globalAlpha=1,e.stroke(),e.globalAlpha=t}},T=(t,e,s)=>{const a=R+e,h=s*TAU*(t/i.width)+this._spinAngle;return[A+a*Math.cos(h),y+a*Math.sin(h)]},E=(t,i,s,a,h)=>{e.beginPath();for(const h of g?[1,-1]:[1])e.moveTo(...T(t,i,h)),e.lineTo(...T(t,i+a,h)),e.lineTo(...T(t+s,i+a,h)),e.lineTo(...T(t+s,i,h));L(h),e.fill()},[C,M,O,k]=this._leds||[],z=t=>(t*C|0)*(k+O)-O,F=!this.showBgColor||o&&!this.overlay?"#000":this._gradients[this._gradient].bgColor;let q=this._barWidth-(_?Math.max(o?M:0,this._barSpacePx):0);0!=this._barSpace||o||(q|=0);let D=0;const H=this._bars.length;for(let t=0;t<u+1;t++){const a=m*t+p*t,h=a+m,_=a+w-(o&&!this._maximizeLeds?O:0);if(B){if(this.overlay&&e.clearRect(0,a-p,i.width,m+p),this.overlay&&!this.showBgColor||(this.overlay&&(e.globalAlpha=this.bgAlpha),e.fillStyle=F,d&&0!=t||e.fillRect(v,a-p,b,(this.overlay&&1==this.reflexAlpha?w:m)+p),e.globalAlpha=1),this.showScaleY&&!l&&!d){const t=s.height,h=t>>1,r=this._analyzer[0].minDecibels,n=this._analyzer[0].maxDecibels,o=w/(n-r);e.fillStyle="#888",e.font=`${h}px sans-serif`,e.textAlign="right",e.lineWidth=1;for(let s=n;s>r;s-=5){const r=a+(n-s)*o,l=s%2==0|0;if(l){const n=r+h*(r==a?.8:.35);-1!=g&&e.fillText(s,.85*t,n),1!=g&&e.fillText(s,i.width-.1*t,n),e.strokeStyle="#888",e.setLineDash([2,4]),e.lineDashOffset=0}else e.strokeStyle="#555",e.setLineDash([2,8]),e.lineDashOffset=1;e.beginPath(),e.moveTo(v+t*l*(-1!=g),.5+~~r),e.lineTo(x-t*l*(1!=g),.5+~~r),e.stroke()}e.setLineDash([]),e.lineDashOffset=0}o?(e.setLineDash([k,O]),e.lineWidth=q):e.lineWidth=c?Math.min(f,q/2):f,e.fillStyle=e.strokeStyle=this._canvasGradient}const C=this._fftData[t];this._analyzer[t].getByteFrequencyData(C);const I=(t,e)=>C[t]+(C[t+1]-C[t])*e;e.beginPath();let G=[];for(let i=0;i<H;i++){const s=this._bars[i],{binLo:u,binHi:m,ratioLo:p,ratioHi:w}=s;let b=Math.max(I(u,p),I(m,w));for(let t=u+1;t<m;t++)C[t]>b&&(b=C[t]);if(b/=255,s.value[t]=b,D+=b,s.peak[t]>0&&(s.hold[t]--,s.hold[t]<0&&(s.peak[t]+=s.hold[t]/S)),b>=s.peak[t]&&(s.peak[t]=b,s.hold[t]=30),!B)continue;l||n?e.globalAlpha=b:c&&(e.globalAlpha=this.fillAlpha),o?(b=z(b),b<0&&(b=0)):b=b*S|0,d&&1==t&&(b*=-1);let A=q,y=s.posX;if(10==r){const s=i?0:(C[this._bars[1].binLo]/255*S*(!d||!t||-1)+b)/2;if(d){if(0==i&&e.lineTo(...T(0,y<0?s:b,1)),y>=0){const t=[y,b];e.lineTo(...T(...t,1)),G.push(t)}}else{if(0==i)if(-1!=g){const t=u?C[u-1]/255*S:b;e.moveTo(v-f,_-t)}else e.moveTo(v,_-(y<v?s:b));(-1!=g||y>=v)&&e.lineTo(y,_-b)}}else if(r>0&&(o?y+=Math.max(M/2,this._barSpacePx/2):0==this._barSpace?(y|=0,i>0&&y>this._bars[i-1].posX+q&&(y--,A++)):y+=this._barSpacePx/2),o){const t=y+q/2;if(this.showBgColor&&!this.overlay){const i=e.globalAlpha;e.beginPath(),e.moveTo(t,a),e.lineTo(t,_),e.strokeStyle="#7f7f7f22",e.globalAlpha=1,e.stroke(),e.strokeStyle=e.fillStyle,e.globalAlpha=i}e.beginPath(),e.moveTo(t,l?a:_),e.lineTo(t,l?h:_-b),e.stroke()}else if(y>=v)if(d)E(y,0,A,b,c);else{const t=y,i=l?a:_,s=A,r=l?h:-b;e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+r),e.lineTo(t+s,i+r),e.lineTo(t+s,i),L(c),e.fill()}const R=s.peak[t];R>0&&this.showPeaks&&!l&&y>=v&&y<x&&(c&&f>0?e.globalAlpha=1:n&&(e.globalAlpha=R),o?e.fillRect(y,_-z(R),q,k):d?10!=r&&E(y,R*S*(!t||-1),A,-2):e.fillRect(y,_-R*S,A,2))}if(B){if(e.globalAlpha=1,10==r){if(d){if(g){let t;for(;t=G.pop();)e.lineTo(...T(...t,-1))}e.closePath()}f>0&&e.stroke(),this.fillAlpha>0&&(d?(e.moveTo(A+R,y),e.arc(A,y,R,0,TAU,!0)):(e.lineTo(x,_),e.lineTo(v,_)),e.globalAlpha=this.fillAlpha,e.fill(),e.globalAlpha=1)}if(this._reflexRatio>0&&!l){let s,h;this.reflexFit||u?(s=u&&0==t?m+p:0,h=m-w):(s=i.height-2*w,h=w),e.globalAlpha=this.reflexAlpha,1!=this.reflexBright&&(e.filter=`brightness(${this.reflexBright})`),e.setTransform(1,0,0,-1,0,i.height),e.drawImage(i,0,a,i.width,w,0,s,i.width,h),e.setTransform(1,0,0,1,0,0),e.filter="none",e.globalAlpha=1}}}h.val=D/(H<<u),h.val>=h.peak?(h.peak=h.val,h.hold=30):h.hold>0?h.hold--:h.peak>0&&(h.peak*=(30+h.hold--)/30),B&&(g&&!d&&(e.setTransform(-1,0,0,1,i.width-v,0),e.drawImage(i,v,0,A,i.height,0,0,A,i.height),e.setTransform(1,0,0,1,0,0)),e.setLineDash([]),this.showScaleX&&(d?(e.save(),e.translate(A,y),this._spinSpeed&&e.rotate(this._spinAngle+HALF_PI),e.drawImage(a,-a.width>>1,-a.width>>1),e.restore()):e.drawImage(s,0,i.height-s.height))),this._frame++;const I=t-this._time;if(I>=1e3&&(this._fps=this._frame/(I/1e3),this._frame=0,this._time=t),this.showFPS){const t=s.height;e.font=`bold ${t}px sans-serif`,e.fillStyle="#0f0",e.textAlign="right",e.fillText(Math.round(this._fps),i.width-t,2*t)}this.onCanvasDraw&&(e.save(),e.fillStyle=e.strokeStyle=this._canvasGradient,this.onCanvasDraw(this),e.restore()),this._runId=requestAnimationFrame((t=>this._draw(t)))}_freqToBin(t,e="round"){const i=this._analyzer[0].frequencyBinCount-1,s=Math[e](t*this.fftSize/this.audioCtx.sampleRate);return s<i?s:i}_makeGrad(){if(!this._ready)return;const t=this._canvasCtx,e=t.canvas,i=this._isLumiBars,s=i?e.height:e.height*(1-this._reflexRatio*!this._stereo)|0,a=1-this._reflexRatio,h=this._initialX,r=e.width>>1,n=e.height>>1,o=Math.min(r,n),l=this._radius,_=this._gradients[this._gradient],c=_.colorStops,d="h"==_.dir;let u;if(u=this._radial?t.createRadialGradient(r,n,o,r,n,l-(o-l)*this._stereo):t.createLinearGradient(...d?[h,0,h+this._analyzerWidth,0]:[0,0,0,s]),c){const t=this._stereo&&!this._splitGradient&&!d,e=(t,e)=>u.addColorStop(t,e.color||e);for(let s=0;s<1+t;s++)c.forEach(((h,r)=>{const n=c.length-1;let o=void 0!==h.pos?h.pos:r/n;if(t&&(o/=2),!this._stereo||i||this._radial||d||(o*=a,!t&&o>.5*a&&(o+=.5*this._reflexRatio)),1==s)if(this._radial||i){const t=n-r;o=1-(void 0!==(h=c[t]).pos?h.pos:t/n)/2}else 0==r&&o>0&&e(.5,h),o+=.5;e(o,h),this._stereo&&r==n&&o<.5&&e(.5,h)}))}this._canvasGradient=u}_setCanvas(t){if(!this._ready)return;const e=this._canvasCtx,i=e.canvas,s=this._scaleX.canvas,a=window.devicePixelRatio/(this._loRes+1);let h=window.screen.width*a,r=window.screen.height*a;90==Math.abs(window.orientation)&&h<r&&([h,r]=[r,h]);const n=this.isFullscreen,o=n&&this._fsEl==i,l=o?h:(this._width||this._container.clientWidth||this._defaultWidth)*a|0,_=o?r:(this._height||this._container.clientHeight||this._defaultHeight)*a|0;this._pixelRatio=a,this._fsWidth=h,this._fsHeight=r,i.width==l&&i.height==_||(i.width=l,i.height=_,this._calcAux(),this.overlay||(e.fillStyle="#000",e.fillRect(0,0,l,_)),e.lineJoin="bevel",s.width=l,s.height=Math.max(20*a,Math.min(l,_)/27|0),this._makeGrad(),this._calcBars(),void 0!==this._fsStatus&&this._fsStatus!==n&&(t="fschange"),this._fsStatus=n,this.onCanvasResize&&this.onCanvasResize(t,this))}_setProps(t,e){const i={alphaBars:!1,barSpace:.1,bgAlpha:.7,fftSize:8192,fillAlpha:1,gradient:"classic",ledBars:!1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,outlineBars:!1,overlay:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,stereo:!1,useCanvas:!0,volume:1},s=["onCanvasDraw","onCanvasResize"],a=Object.keys(i).filter((t=>"start"!=t)).concat(s,["height","width"]);t&&void 0!==t.showLeds&&void 0===t.ledBars&&(t.ledBars=t.showLeds),(e||void 0===t)&&(t={...i,...t});for(const e of Object.keys(t))s.includes(e)&&"function"!=typeof t[e]?this[e]=void 0:a.includes(e)&&(this[e]=t[e]);void 0!==t.start&&this.toggleAnalyzer(t.start)}}class AudioMotionError extends Error{constructor(t,e){super(e),this.name="AudioMotionError",this.code=t}}
//# sourceMappingURL=/sm/3fa4b5fb8c85fcf542769e3e7e6f82dbe537cd395a5a2f58ba50b108c17af47c.map