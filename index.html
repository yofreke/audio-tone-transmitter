<html>
  <style>
    body {
      font-family: Verdana, Geneva, Tahoma, sans-serif;
    }

    input[type=range] {
      width: 325px;
    }

    .card {
      padding: 15px;
      margin: 20px;
      border: 1px solid gray;
    }
  </style>

  <body>

    <div class="frequencyGenerator card">
      <h3>Frequency Generator</h3>

      frequency: <span id="frequencyDisplay"></span>
      <br>
      <!-- Oscillator.frequency.value 24000 outside nominal range [-22050, 22050]; value will be clamped. -->
      <input type="range" id="frequencyInput" min="1" max="22050" value="440" oninput="updateValues()" />
      <br>

      volume: <span id="volumeDisplay"></span>
      <br>
      <input type="range" id="volumeInput" min="1" max="100" value="20" oninput="updateValues()" />
      <br>

      <!-- duration: <span id="durationDisplay"></span>
      <br>
      <input type="range" id="durationInput" min="1" max="100" value="4" oninput="updateValues()" />
      <br> -->

      <br>
      <button onclick='startOutput();'>Start</button>
      <button onclick='stopOutput();'>Stop</button>
    </div>

    <div class="card">
      <h3>Spectrum Analyzer</h3>

      <button onclick='createAudioMotion();'>Start</button>

      <div id="container" class="fluid"></div>
    </div>
  </body>
<script>

// one context per document
var context = new (window.AudioContext || window.webkitAudioContext)();
window.mainAudioContext = context;

var osc;
var vol;
function newOsc() {
  // instantiate an oscillator
  osc = context.createOscillator();
  vol = context.createGain();
  window.mainGainNode = vol;

  // this is the default - also square, sawtooth, triangle
  osc.type = 'sine';

  // Connect volume
  osc.connect(vol); // connect osc to vol
  vol.connect(context.destination); // connect vol to context destination

  // Do not connect directly if trying to use gain node
  // connect it to the destination
  // osc.connect(context.destination)

  updateValues();
}

// let duration = 4;

function updateValues() {
  const frequencyEl = document.getElementById('frequencyInput')
  const frequencyDisplayEl = document.getElementById('frequencyDisplay')
  const frequencyInput = frequencyEl.value
  // Hz
  osc.frequency.value = frequencyInput
  frequencyDisplayEl.innerHTML = frequencyInput

  const volumeEl = document.getElementById('volumeInput')
  const volumeDisplayEl = document.getElementById('volumeDisplay')
  const volumeInput = volumeEl.value
  // from 0 to 1, 1 full volume, 0 is muted
  vol.gain.value = volumeInput / 100
  volumeDisplayEl.innerHTML = volumeInput

  // const durationEl = document.getElementById('durationInput')
  // const durationDisplayEl = document.getElementById('durationDisplay')
  // const durationInput = durationEl.value
  // duration = durationInput
  // durationDisplayEl.innerHTML = durationInput
}

function startOutput() {
  console.log('startOutput');
  osc.start(context.currentTime); // start the oscillator
  // osc.stop(context.currentTime + duration); // stop 2 seconds after the current time
}

function stopOutput() {
  console.log('stopOutput');
  // osc.stop(context.currentTime + duration); // stop 2 seconds after the current time
  osc.stop();
}

newOsc();
updateValues();

</script>

<script type="module" src="./main.js"></script>
</html>
